<div class="modal-container modal-container-hidden" id="modal-container-delete">
    <div class="modal modal-hidden" id="modal-details-delete">
        <h2 class="modal-header header">Delete event?</h2>
        <p class="modal-description">The event will be deleted and will<br>not show up in any records</p>
        <div class="modal-controls">
            <button class="bg-button button" id="cancel-modal-no-button">
                <div class="button-wrapper">
                    <i class="lni lni-check"></i>
                    <p>Keep event</p>
                </div>
            </button>
            <button class="destructive-button button" id="delete-modal-yes-button">
                <div class="button-wrapper">
                    <i class="lni lni-trash-3"></i>
                    <p>Delete</p>
                </div>
            </button>
        </div>
    </div>
</div>

<div class="modal-container modal-container-hidden" id="modal-container-cancel">
    <div class="modal modal-hidden" id="modal-details-cancel">
        <h2 class="modal-header header">Cancel event?</h2>
        <p class="modal-description">The event will be cancelled, you can <br>still view event in past events</p>
        <div class="modal-controls">
            <button class="bg-button button" id="cancel-modal-no-button">
                <div class="button-wrapper">
                    <i class="lni lni-check"></i>
                    <p>Keep event</p>
                </div>
            </button>
            <button class="destructive-button button" id="cancel-modal-yes-button">
                <div class="button-wrapper">
                    <i class="lni lni-xmark"></i>
                    <p>Cancel</p>
                </div>
            </button>
        </div>
    </div>
</div>

<div class="top-page-bar">
    <button class="back-link">
        <a class="button-wrapper" href="/eventlist">
            <i class="lni lni-arrow-left"></i>
            <p>Back</p>
        </a>
    </button>
    <h2 class="header">Event Details</h2>
</div>
    <div class="event-details card">
        {{#if showButtons}}
        <div class="event-controls">
            <button class="bg-button button" id="details-edit-button">
                <a class="bg-button-wrapper button-wrapper" href="#">
                    <i class="lni lni-pencil-1"></i>
                    <p>Edit</p>
                </a>
            </button>
            <form action="/deleteEvent?id={{event._id}}">
                    <button type="submit" class="bg-button button" id="details-delete-button">
                    <span class="bg-button-wrapper button-wrapper">
                    <i class="lni lni-xmark"></i>
                         <p>Delete</p>
                    </span>
                    </button>
            </form>

        </div>
        {{/if}}

    <div class="event-box-top" id="details-top-box">
        <span id="event-name"></span>
        <span id="client-name"></span>
    </div>

    <div class="event-box-bottom" id="details-box">
        <span id="date-loc">
            <span id="date"></span>
            <span id="location"></span>
        </span>
        <span id="contact">
            <span><strong>Contact Person</strong></span>
            <span id="contact-name"></span>
            <span id="contact-info"></span>
        </span>
        <span id="description-span">
            <span><strong>Description</strong></span>
            <span id="description"></span>
        </span>
    </div>

    <span id="status"></span>
    
        <div class="choice-buttons" id="details-choices">
            {{#if showButtons}}
            <form action="/cancelEvent?id={{event._id}}" method="POST" onsubmit="return confirm('Are you sure you want to cancel this event?');">
              <button type="submit" class="bg-button button" id="cancel-button">
                 <span class="bg-button-wrapper button-wrapper">
                 <i class="lni lni-xmark"></i>
                 <p>Cancel</p>
                </span>
             </button>
            </form>

            {{/if}}
            
            {{#if showButtons}}
            <button class="fg-button button" id="mark-done-button">
                <a class="fg-button-wrapper button-wrapper" href="#">
                    <i class="lni lni-check"></i>
                    <p>Mark as done</p>
                </a>
            </button>
            {{/if}}
        </div>

            {{!-- displays the team members lang  --}}
           <div class="members-box">
             {{#if teamMembers.length}}
                 <ul>
                 {{#each teamMembers}}
                 <li>{{firstName}} {{lastName}}</li>
             {{/each}}
                </ul>
                {{else}}
                 <p>Currently no members in this event.</p>
            {{/if}}
            </div>
        

    <div class="team-members">
         <h3 class="header">Team Members</h3>
         <form role="search" class="search-bar" onsubmit="return false;">
         <button type="submit"><i class="lni lni-search-1"></i></button>
             <input type="search" name="q" id="searchInput" placeholder="Search..." autocomplete="off">
         </form>

         <div class="members-box">
             <ul id="memberList"></ul>
        <p id="emptyMessage" style="display: none;">No matching team members found.</p>
        </div>
        

    <div class="team-members">
         <form role="search" class="search-bar" onsubmit="return false;">
         <button type="submit"><i class="lni lni-search-1"></i></button>
             <input type="search" name="q" id="searchInput" placeholder="Search..." autocomplete="off">
         </form>

         <div class="members-box">
             <ul id="memberList"></ul>
        <p id="emptyMessage" style="display: none;">No matching team members found.</p>
        </div>
    </div>

    {{#if showButtons}}
        <button class="fg-button button" id="attendance-check-button">
            <a class="fg-button-wrapper button-wrapper" href="/eventAttendance?id={{event._id}}">
                <i class="lni lni-user-multiple-4"></i>
                <p>Check attendance</p>
            </a>
        </button>
    {{/if}}

    <script>
    const teamId = '{{team._id}}'; //gets the teamid in eventDetailsController
    </script>

    <script>
        const searchInput = document.getElementById('searchInput');
        const memberList = document.getElementById('memberList');
        const emptyMessage = document.getElementById('emptyMessage');
  
       function debounce(fn, delay) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn.apply(this, args), delay);
             };
         }

         async function fetchTeamMembers(query) {
             if (!query.trim()) {
                 memberList.innerHTML = '';
                 emptyMessage.style.display = 'none';
             return;
            }

    try {
        const response = await fetch(`/searchTeamMembers?q=${encodeURIComponent(query)}&id=${teamId}`);
        const data = await response.json();

         // Clear the list
        memberList.innerHTML = '';

        if (data.results.length === 0) {
            emptyMessage.style.display = 'block';
        } else {
             emptyMessage.style.display = 'none';
             data.results.forEach(member => {
                const li = document.createElement('li');
                li.textContent = `${member.firstName} ${member.lastName}`;
                memberList.appendChild(li);
                });
            }
        } catch (err) {
        console.error('Search failed:', err);
    }
  }

        searchInput.addEventListener('input', debounce((e) => {
        fetchTeamMembers(e.target.value);
        }, 300));
    </script>

       
    </div>
    
</div>